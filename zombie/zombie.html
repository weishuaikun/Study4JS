<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>植物大战僵尸</title>
	</head>

	<body>
		<div id="stage" style="margin: 0 auto; width: 1400px; height: 600px; background: #323232; text-align: center; vertical-align: middle" >
			<canvas id="canvas"  width="1400" height="600">
				不支持画板对象时能看到
			</canvas>
		</div>
		<script type="text/javascript" src="tools.js"></script>
		<script type="text/javascript">
			var canvas = document.getElementById("canvas");
			var ctx = canvas.getContext("2d");

			//第二只移动僵尸的坐标
			var x = 1200;
			var y = 110;
			var index = 1;
			var i = 0;
			//表示僵尸的状态：1表示移动，2表示攻击状态，3表示站立
			var t1 = 1;
			//记录僵尸攻击的次数
			var n = 0;
			
			
			
			//第四只移动僵尸的x坐标
			var x1 = 1200;
			
			//===============================
			//第三只移动僵尸的x坐标
			var x3 = 1200;
			//第三只僵尸的状态
			var t3 = 1;
			//第三只僵尸攻击的次数
			var n3 = 0;
			


			setInterval(function() {
				//画背景
				ctx.drawImage(bg, 0, 0);
				//画各种植物
				ctx.drawImage(plant1, 250, 80);
				ctx.drawImage(plant2, 250, 300);
				//==================================
				//ctx.drawImage(plant3, 250, 400);
				//只有攻击次数小于10次才画植物，超过10次植物就消失
				if(n3 < 10){
					ctx.drawImage(plant3,250,400);
				}
				
				ctx.drawImage(plant4, 350, 500);
				//ctx.drawImage(nut1, 490, 150);
				//根据攻击次数画不同的坚果图片
				if (n <= 10) {
					ctx.drawImage(nut1, 490, 150);
				} else if (n <= 20) {
					ctx.drawImage(nut2, 490, 150);
				} else if (n <= 35) {
					ctx.drawImage(nut3, 490, 150);
				}

				//根据攻击次数和僵尸的坐标  设置僵尸的状态
				if (n > 35 && x >= 150 && x <= 500) {
					//吃掉坚果了，并且位于移动区域
					t1 = 1;
				} else if (x < 150) {
					//到达墙壁了,停止移动并且画出僵尸吃了你的脑子
					t1 = 3;
					ctx.drawImage(bg_end, 500, 50);
				} else if (x < 500) {
					//能执行到这说明还坚果没有被消灭，因此使用攻击状态
					t1 = 2;
				}
				//===============================
				if (n3 > 10 && x3 >= 150 && x3 <= 250) {
					//吃掉坚果了，并且位于移动区域
					t3 = 1;
				} else if (x3 < 150) {
					//到达墙壁了,停止移动并且画出僵尸吃了你的脑子
					t3 = 3;
					ctx.drawImage(bg_end, 500, 50);
				} else if (x3 < 250) {
					//能执行到这说明还坚果没有被消灭，因此使用攻击状态
					t3 = 2;
				}

				//画僵尸
				ctx.drawImage(zombieM1, 1200, y - 100);
				//ctx.drawImage(zombieM1, x, y);
				ctx.drawImage(zombieM1, 1200, y + 100);
				//ctx.drawImage(zombieM1, 1200, y + 200);
				//当第二只僵尸吃到植物后让第四只僵尸移动起来
				if(x <= 500 && x > 150){
					if(index % 2 == 1){
						ctx.drawImage(zombieM1,x1,y+200);
					}else if(index % 2 == 0){
						ctx.drawImage(zombieM4,x1,y+200);
					}
					x1 = x1 -2;
				}else{
					ctx.drawImage(zombieM1,x1,y+200);
				}

				ctx.drawImage(zombieM1, 1200, y + 300);

				//根据不同的状态给第二只僵尸画不同的图片
				if (t1 == 1) {
					//处于移动状态，那么就切换移动状态的图片
					if (index % 2 == 1) {
						ctx.drawImage(zombieM1, x, y);
					} else if (index % 2 == 0) {
						ctx.drawImage(zombieM4, x, y);
					}
				} else if (t1 == 2) {
					//处于攻击状态,那么久切换攻击状态的图片
					if (index % 2 == 1) {
						ctx.drawImage(zombieA1, x, y);
					} else if (index % 2 == 0) {
						ctx.drawImage(zombieA4, x, y);
						//攻击次数加一
						n = n + 1;
					}
				} else {
					//站立状态的僵尸
					ctx.drawImage(zombieA4, x, y);
				}
				//=================================
				//根据不同的状态给第三只僵尸画不同的图片
				if (t3 == 1) {
					//处于移动状态，那么就切换移动状态的图片
					if (index % 2 == 1) {
						ctx.drawImage(zombieM1, x3, y+200);
					} else if (index % 2 == 0) {
						ctx.drawImage(zombieM4, x3, y+200);
					}
				} else if (t3 == 2) {
					//处于攻击状态,那么久切换攻击状态的图片
					if (index % 2 == 1) {
						ctx.drawImage(zombieA1, x3, y+200);
					} else if (index % 2 == 0) {
						ctx.drawImage(zombieA4, x3, y+200);
						//攻击次数加一
						n3 = n3 + 1;
					}
				} else {
					//站立状态的僵尸
					ctx.drawImage(zombieA4, x3, y+200);
				}
				

				//判断僵尸的状态，只有处于移动状态x坐标才发生改变
				if (t1 == 1) {
					x = x - 2;
				}
				//===================================
				if (t3 == 1){
					x3 = x3 - 2;
				}

				//控制移动速度
				i = i + 1;
				if (i % 8 == 0) {
					index = index + 1;
				}

			}, 10);
		</script>
	</body>
</html>
