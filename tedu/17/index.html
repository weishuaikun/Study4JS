<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>飞机大战</title>
	</head>

	<body>
		<div id="stage" style="margin: 0 auto; width: 480px; height: 650px; text-align: center; vertical-align: middle" >
			<canvas id="canvas" style="border:0px solid red;" width="480" height="650">
				不支持画板对象
			</canvas>
		</div>
		<script>
			var canvas = document.getElementById('canvas');
			var ctx = canvas.getContext('2d');

			var background = new Image();
			background.src = "images/background.png";

			var sky = new Sky();

			var enemy1 = new Image();
			enemy1.src = "images/enemy1.png";

			var enemy2 = new Image();
			enemy2.src = "images/enemy2.png";

			var enemy3 = new Image();
			enemy3.src = "images/enemy3.png";

			setInterval(function() {
				componentEnter();
				sky.paint(ctx);
				sky.step();
			}, 10);

			var enemies = [];
			function componentEnter() {
				var n = parseInt(Math.random() * 10);
				switch(n) {
					case 0:
					case 1:
					case 2:
					case 3:
					case 4:
					case 5:
					case 6:
					case 7:
						enemies[1] = new Enemy(0, -51, 57, 51, 1, 1, 1, enemy1);
						break;
					case 8:
						enemies[2] = new Enemy(0, -95, 69, 95, 2, 3, 5, enemy2);
						break;
					case 9:
						if (enemies[0] == undefined || enemies[0].type != 3) {
							enemies.splice(0, 0, new Enemy(0, 0, 169, 258, 3, 20, 20, enemy3));
						}
				}
			}

			function Sky() {
				this.img = background;
				this.width = 480;
				this.height = 852;
				this.x1 = 0;
				this.y1 = 0;
				this.x2 = 0;
				this.y2 = -this.height;
				this.paint = function(ctx) {
					ctx.drawImage(this.img, this.x1, this.y1);
					ctx.drawImage(this.img, this.x2, this.y2);
				}
				this.step = function() {
					this.y1 = this.y1 + 1;
					this.y2 = this.y2 + 1;
					if (this.y1 > this.height) {
						this.y1 = -this.height;
					}
					if (this.y2 > this.height) {
						this.y2 = -this.height;
					}
				}
			}

			function Enemy(x, y, width, height, type, life, score, img) {
				this.score = score;
				this.type = type;
				this.width = width;
				this.height = height;
				this.x = Math.random() * (480 - this.width);
				this.y = -this.height;
				this.life = life;
				this.img = img;
				this.paint = function(ctx) {
					ctx.drawImage(this.img, this.x, this.y);
				}
				this.step = function() {
					this.y = this.y + 2;
				}
			}

		</script>
	</body>
</html>